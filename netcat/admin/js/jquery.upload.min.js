!function(v){if(v){var o=5242880,c="FileReader"in window;v.fn.upload=function(){return this.each(function(){var e=v(this);if(!e.hasClass("nc-upload-applied")){e.addClass("nc-upload-applied");var i,a=d(e),n=e.find(".nc-upload-files"),l=n.find(".nc-upload-file");if(0<l.length&&!a&&e.find(".nc-upload-input").hide(),l.each(function(){var e=v(this),n=e.data("type"),a=e.find(".nc-upload-file-name");t(e,n,a.html(),a.data("preview-url"),!1)}),setTimeout(function(){C(e)},10),e.on("change",".nc-upload-input",function(){var e,u,s,c,p,n,f,r;a?(s=v(u=this),c=g(s),p=c.data("maxFiles"),n=c.data("fieldName"),f=function(e){return"multifile_"+e+"["+n+"][]"},r=h(u),s.hide().clone().val("").appendTo(c).show(),s.removeClass("nc-upload-input").appendTo(c.find(".nc-upload-new-files")),v.each(r,function(e){var n,a,i,l=(a="nextUploadIndex",i=(n=c).data(a)||0,n.data(a,i+1),i);1==r.length&&s.addClass("nc-upload-file-index--"+l);var d=m(u,e).hide().data("uploadIndex",l).append(x(f("id")),x(f("upload_index"),l),x(f("delete"),0).addClass("nc-upload-file-remove-hidden"));if(c.data("customName")){var o=c.data("customNameCaption"),t=y("text",f("name"),"",o);v('<div class="nc-upload-file-custom-name"/>').append(t).appendTo(d)}p&&"0"!=p&&w(c)>=p?b(d):d.slideDown(100)}),C(c)):(e=this).value&&(m(e,0).hide().slideDown(100).find(".nc-upload-file-custom-name input:text").focus(),C(g(e)))}),n.find(".nc-upload-file-remove").attr("onclick",""),u(n),a&&e.append(x("multifile_js["+e.data("fieldName")+"]",1)),a)n.on("mousedown",".nc-upload-file-drag-handle",function(e){e.preventDefault(),n.addClass("nc--dragging"),i=v(this).closest(".nc-upload-file").addClass("nc--dragged"),v(window).on("mouseup.nc-upload",function(){n.removeClass("nc--dragging"),i.removeClass("nc--dragged"),v(window).off("mouseup.nc-upload"),i=null})}),n.on("mousemove",".nc-upload-file",function(e){var n,a=v(this);if(i&&!a.hasClass("nc--dragged")){if("none"==a.css("float"))n=e.pageY-a.offset().top<a.height()/2;else n=e.pageX-a.offset().left<a.width()/2;n?i.insertBefore(a):i.insertAfter(a)}})}})},v(document).on("apply-upload",function(e){v(".nc-upload").upload()})}function m(e,n){var a=h(e)[n],i=v('<div class="nc-upload-file"><div class="nc-upload-file-info"><span class="nc-upload-file-name">'+a.name+'</span> <a href="#" class="nc-upload-file-remove" tabindex="-1">Ã—</a></div></div>'),l=g(e).find(".nc-upload-files");if(c&&a.size<o&&p(a.type)){var d=new FileReader;d.onload=function(e){t(i,a.type,a.name,e.target.result,!0)},d.readAsDataURL(a)}else t(i,a.type,a.name,null,!0);return i.appendTo(l),u(i),i}function t(e,n,a,i,l){var d="nc-upload-file-preview",o="nc-upload-file-drag-handle",t=v("<div/>").addClass(d+" "+o),u=i&&p(n);if(u&&c)t.addClass(d+"-image").append('<img src="'+i+'" />'),g(e).addClass("nc-upload-with-preview");else{var s=a.lastIndexOf(".");t.addClass(d+"-other"),0<s&&t.append('<span class="nc-upload-file-extension">'+a.substr(s+1)+"</span>")}return e.prepend('<div class="nc-upload-file-drag-icon '+o+'"><i class="nc-icon nc--file-text"></i></div>',t),(u||e.closest(".nc-upload-with-preview").length)&&c&&(l?t.slideDown(100):t.show()),t}function p(e){return/^image\/(jpe?g|png|gif|bmp|svg([+-]xml)?)$/i.test(e)}function h(e){return c?e.files:[{name:e.value.substr(e.value.lastIndexOf("\\")+1),type:"",size:0}]}function d(e){return e.hasClass("nc-upload-multifile")}function g(e){return v(e).closest(".nc-upload")}function w(e){return e.find(".nc-upload-file:visible").length}function C(e){var n=d(e)?e.data("maxFiles"):1;n&&e.find(".nc-upload-input").toggle(w(e)<n)}function x(e,n){return y("hidden",e,n)}function y(e,n,a,i){return v("<input />",{type:e,name:n,value:void 0===a?"":a,placeholder:i||""})}function a(e){e.preventDefault(),e.stopPropagation();var n=v(e.target).closest(".nc-upload-file"),a=g(n),i=a.find(".nc-upload-input"),l=i;return b(n),d(a)?a.find(".nc-upload-file-index--"+n.data("uploadIndex")).val(""):(l=i.clone().val("").show(),i.replaceWith(l)),n.slideUp(100,function(){var e="nc-upload-with-preview";a.hasClass(e)&&0==a.find(".nc-upload-file:visible .nc-upload-file-preview-image").length&&a.removeClass(e);var n=v.Event("change");n.target=l[0],v(document).trigger(n),C(a)}),!1}function b(e){e.find(".nc-upload-file-remove-hidden").val(1).trigger("change")}function u(e){var n="click.nc-upload";e.find(".nc-upload-file-remove").off(n).on(n,a)}}(window.$nc||window.jQuery);