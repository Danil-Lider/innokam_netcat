!function(){if("undefined"!=typeof nc&&nc===nc.root){var c=nc.root.$;c(window).on("resize.modal_dialog",function(){c(".simplemodal-container").each(function(){var t=c(this).data("modal_dialog");t&&t.resize&&t.resize()})});var t="nc.ui.modal_dialog.load()",a="nc.ui.modal_dialog.submit_form()",e=null,s=0,i="keydown.modal_dialog";d.get_opened_dialog=function(){return e&&e.is_open?e:null},d.get_current_dialog=function(){return e},d.get_previous_dialog=function(){for(var t=s;0<--t;){var i=c("#"+o(t)).data("modal_dialog");if(i)return i}return null},d.prototype={constructor:d,options:{url:null,parameters:null,persist:!1,confirm_close:!0,on_show:c.noop,on_resize:c.noop,on_submit_response:null,width:null,height:null,min_width:600,max_width:1200,full_markup:'<div class="nc-modal-dialog"><div class="nc-modal-dialog-header"><h2>&nbsp;</h2></div><div class="nc-modal-dialog-body"></div><div class="nc-modal-dialog-footer"></div></div>',hidden_tabs:null,show_close_button:!0},loaded_markup:null,dialog_container:null,parts:{header:".nc-modal-dialog-header",title:".nc-modal-dialog-header h2",header_tabs:".nc-modal-dialog-header-tabs",body:".nc-modal-dialog-body",body_tabs:".nc-modal-dialog-body-tab",footer:".nc-modal-dialog-footer"},is_loaded:!1,is_open:!1,are_tabs_initialized:!1,has_header:!0,has_unsaved_changes:!1,index:0,set_options:function(t){this.options=c.extend(this.options,t)},set_option:function(t,i){this.options[t]=i},get_option:function(t){return this.options[t]},load:function(){var i=this;return nc.process_start(t),c.ajax({method:this.options.method||"GET",url:this.options.url,data:c.extend({isNaked:1},this.options.parameters||{})}).done(function(t){i.loaded_markup=c.trim(t)}).always(function(){i.is_loaded=!0,nc.process_stop(t,0)})},create:function(){if(!this.is_loaded)return this.load().done(c.proxy(this,"create"));var t,i=this.options;if(this.loaded_markup){var o=c(this.loaded_markup);if(o.is(".nc-modal-dialog"))t=o;else{var n=o.find(".nc-modal-dialog");n.length&&(t=n)}}t||(t=c(i.full_markup),this.loaded_markup&&t.find(".nc-modal-dialog-body").append(this.loaded_markup));var a=t.find("script").remove();return(e=this).dialog_container=t.hide().appendTo("body"),this.get_part("header").length||(this.dialog_container.addClass("nc-modal-dialog-without-header"),this.has_header=!1),this.init_options(),this.init_close_button(),this.init_tabs(),this.init_forms(),this.init_buttons(),t.append(a),c.Deferred().resolve()},init_options:function(){var o=this.options,t=this.dialog_container;for(var i in o){var n=t.data(i.replace(/_/g,"-"));void 0!==n&&n.toString().length&&(o[i]=n)}var a,e=this.options.hidden_tabs;for(var s in null===e?o.hidden_tabs=[]:c.isArray(e)||(o.hidden_tabs=[],c.each(e.match(/[\w-]+/g),function(t,i){o.hidden_tabs.push(i)})),{confirm_close:1,show_close_button:1})o[s]="boolean"!=typeof(a=o[s])?!/^(no|false|0)$/i.test(a.toString()):a},init_close_button:function(){this.options.show_close_button&&c('<a class="nc-modal-dialog-header-close-button" title="'+ncLang.Close+'" />').click(c.proxy(this,"close")).appendTo(this.get_part("header"))},init_buttons:function(){var t=this,i="click.modal_dialog",o=this.get_part("footer").find("button").off(i);o.filter("[data-action=close]").on(i,c.proxy(this,"close")),o.filter("[data-action=submit]").on(i,function(){c(this).hasClass("nc--loading")||(nc.process_start(a,this),t.submit_form())}),o.filter('[data-action="save-draft"]').toggle(l(this)).on(i,function(t){t.preventDefault(),window.autosave&&(c(this).addClass("nc--loading"),autosave.saveAllData(autosave))})},init_tabs:function(){if(!this.are_tabs_initialized){this.are_tabs_initialized=!0;var o=this,t=this.get_part("body").find("[data-tab-caption]");if(o.dialog_container.toggleClass("nc-modal-dialog-without-tabs",0===t.length),t.length){var i=this.get_part("header_tabs");i.length||(i=c('<div class="nc-modal-dialog-header-tabs"/>').appendTo(this.get_part("header")));var n=i.children("ul"),a=1;n.length||(n=c("<ul/>").appendTo(i)),t.addClass("nc-modal-dialog-body-tab").hide().each(function(){var t=c(this).data("tab-id")||"tab"+a++,i=c(this).attr("data-tab-id",t);c("<li>",{"data-tab-id":t,html:i.data("tab-caption")}).appendTo(n).click(function(t){o.change_tab(c(t.target).data("tab-id"))})}),c.each(this.options.hidden_tabs,function(t,i){o.hide_tab(i)}),this.change_tab(t.eq(0).data("tab-id"))}}},get_form:function(){var t=this.find("#adminForm");return t.length||(t=this.find("form").first()),t},init_forms:function(){InitTransliterate();var o=c.proxy(this,"process_form_submit_response");this.find("form").each(function(){var t=c(this);t.ajaxForm({beforeSerialize:nc_save_editor_values,success:o,iframe:!0});var i=t.attr("action");i=_(i=_(i,"isNaked",1),"admin_modal",1),t.attr("action",i)})},init_change_tracking:function(){if(this.options.confirm_close){var t=this,i=function(){t.has_unsaved_changes=!0};this.has_unsaved_changes=!1,this.dialog_container.one("change",":input",i).one("input textinput","div[contenteditable]",i)}},submit_form:function(t){this.has_unsaved_changes=!1,(t=t?c(t):this.get_form()).submit()},process_form_submit_response:function(t,i,o,n){return nc.process_stop(a),(c.isFunction(this.options.on_submit_response)?this.options.on_submit_response:this.default_form_submit_response_handler).call(this,t,i,o,n)},default_form_submit_response_handler:function(t,i,o,n){var a=nc_check_error(t);if(a)this.show_error(a);else{var e=n.find("input[name=cc]").val()||n.find("input[name=infoblock_id]").val(),s=window.location,d=/^NewHiddenURL=(.+?)$/m.exec(t),r=d?c.trim(d[1]):null,l=/^SetLocationHash=(.*?)$/m.exec(t);if(l&&(window.location.hash=l[1]),/^ReloadPage=1$/m.test(t))if(r&&!/\.php/.test(window.location.pathname)){var h=/\/([^\/]+)$/.exec(s.pathname);h&&(r+=h[1]),s.pathname=r}else s.reload(!0);else e&&nc_update_admin_mode_infoblock(e,c.proxy(this,"destroy"))}},show_error:function(t){var i=this.get_part("footer"),o=c("<div class='nc-alert nc--red' />").append(c("<div class='nc-alert-close nc-icon-s nc--remove'></div>").click(function(){o.remove()})).append("<i class='nc-icon-l nc--status-error'></i>").append(t).appendTo(i)},change_tab:function(t){var i=h(t);return this.get_part("header_tabs").find("li").removeClass("nc--active").filter(i).addClass("nc--active").show(),this.get_part("body_tabs").hide().filter(i).show(),this},hide_tab:function(t){var i=h(t);return this.get_part("header_tabs").find("li"+i).hide(),this.get_part("body_tabs").filter(i).hide(),this},show_tab:function(t){var i=h(t);return this.get_part("header_tabs").find("li"+i).show(),this.get_part("body_tabs").filter(i).show(),this},get_tab:function(t){return this.get_part("body").find(h(t))},get_current_tab:function(){var t=this.get_part("body_tabs");return t.length?t.filter(":visible"):this.get_part("body")},hide_header_tabs:function(){return this.dialog_container.addClass("nc-modal-dialog-without-tabs"),this},show_header_tabs:function(){return this.dialog_container.removeClass("nc-modal-dialog-without-tabs"),this},open:function(){return s&&(c("#simplemodal-container").attr("id",o()).data({modal_d:c.modal.impl.d,modal_o:c.modal.impl.o}),c("#simplemodal-overlay").attr("id",""),c.modal.impl.d={}),s++,this.index=s,this.dialog_container?this.when_ready_to_open():this.create().done(c.proxy(this,"when_ready_to_open")),this},when_ready_to_open:function(){c.modal(this.dialog_container,{onOpen:null,onShow:c.proxy(this,"on_show"),onClose:n,autoPosition:!1,persist:this.options.persist,closeHTML:"",zIndex:1e4+10*s}),c("#simplemodal-container").data("modal_dialog",this),c(window).off(i).on(i,r),this.is_open=!0,this.init_change_tracking(),this.resize()},on_show:function(){this.options.on_show(this),l(this)&&InitAutosave("adminForm")},close:function(){if(this.is_open&&this.is_close_confirmed()){if(this.index===s)c.modal.close();else{var t=c("#"+o(this.index));t.prev(".simplemodal-overlay").remove(),t.remove()}this.is_open=!1,this.options.persist||this.destroy(),this.index<=1&&c(window).off(i)}},is_close_confirmed:function(){return!this.options.confirm_close||!this.has_unsaved_changes||confirm(window.TEXT_SAVE||"Выйти без сохранения?")},resize:function(){if(!this.is_open)return this;var t=c(window.top.window),i=this.options,o=t.width(),n=window.innerHeight||window.clientHeight||t.height(),a=n-200,e=i.width||o-200,s=i.height||a,d="auto"===s,r=this.dialog_container.closest(".simplemodal-container"),l=Math.ceil;e>i.max_width&&(e=i.max_width),!i.width&&e<i.min_width&&(e=i.min_width),r.css({width:e+"px",height:s+(d?"":"px"),left:l((o-e)/2-10)+"px",top:"120px"}).find(".simplemodal-wrap").css("overflow","auto"),d&&(r.height()>a&&r.css("height",a+"px"),r.css("top",Math.max(l((n-r.height())/2),100)+"px"));var h=this.get_part("body").find(".nc--fill");return h.length&&h.css("height",r.height()+"px"),i.on_resize(),this},destroy:function(){this.close(),window.CKEDITOR&&this.dialog_container.find("textarea").each(function(){this.name in CKEDITOR.instances&&CKEDITOR.remove(CKEDITOR.instances[this.name])}),this.dialog_container.remove()},clear_all:function(){for(var t in this.parts)this.clear(t)},clear_part:function(t){this.get_part(t).empty()},find:function(t){return this.dialog_container||this.create(),this.dialog_container.find(t)},get_part:function(t){return this.find(this.parts[t])}},nc.ext("modal_dialog",d,"ui")}function d(t){return this instanceof d?(this.options=c.extend(!0,{},this.options),this.set_options(t),this.options.url||(this.is_loaded=!0),this):new d(t)}function o(t){return"simplemodal-container--"+(t||s)}function n(){var t=d.get_opened_dialog();if(null!==t){var i=t.options.persist,o=c("#simplemodal-placeholder");if(i&&this.d.placeholder?o.replaceWith(this.d.data.removeClass("simplemodal-data").css("display",this.display)):(o.remove(),t.dialog_container.remove()),c("#simplemodal-container, #simplemodal-overlay").remove(),this.d={},e=d.get_previous_dialog()){s=e.index;var n=e.dialog_container.closest(".simplemodal-container").attr("id","simplemodal-container");this.d=n.data("modal_d"),this.o=n.data("modal_o"),this.occb=!1,this.unbindEvents(),this.bindEvents(),c(".simplemodal-overlay").last().attr("id","simplemodal-overlay")}else s=0,window.autosave&&(autosave.stopTimer(),autosave=null)}}function r(t){if(27===t.keyCode){var i=c(t.target);i.is(":input")&&i.blur(),d.get_opened_dialog().close()}}function l(t){if(!window.nc_autosave_use||!window.InitAutosave)return!1;var i=t.get_form();return"adminForm"===i.attr("id")&&!!i.find(':hidden[name="message"]').val()&&!!i.find(':hidden[name="cc"]').val()}function h(t){return'[data-tab-id="'+t+'"]'}function _(t,i,o){t&&(new RegExp("[?&]"+i+"=").test(t)||(t+=(0<=t.indexOf("?")?"&":"?")+i+"="+o));return t}}(window);