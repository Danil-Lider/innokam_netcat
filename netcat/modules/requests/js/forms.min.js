(function(c,f){function p(a,b,d){return c("<"+a+">").addClass("tpl-block-popup"+b).append(d)}function k(a,b){return p("div",a,b)}function t(a,b,d){return c("<input>",{type:"hidden",name:b,value:d}).appendTo(a)}function u(){if(0>l){var a=c("<div/>").css({position:"absolute",top:-1E3,left:-1E3,width:100,height:100,overflow:"auto"}).prependTo("body").append("<div/>").find("div").css({width:"100%",height:200});l=100-a.width();a.parent().remove()}return l}function n(a,b,d,e,m){b=k(b+" tpl-block-popup "+
a).data({closeAll:e,disableAnimation:m});var g=q(a);a=k("-container"+(m?"":" tpl-state-animated tpl-animation-fade-in-down"),[p("a","-close-button").click(g),k("-icon"),k("-body").html(d)]);b.append([k("-background").click(g),a]).appendTo("body");c(f).off("resize",h).on("resize",h);b.find("img").on("load",h);h();a=c("body");e=c(f);a.data("ncRequestsStyle")||a.data("ncRequestsStyle",a.attr("style")||" ");c(document).height()>e.height()&&(d=a.offset().left,e=e.width()-a.outerWidth(!0)-d,a.css({"overflow-y":"hidden",
"margin-left":d+"px","margin-right":e+u()+"px"}));a.off("keyup.popup-close").on("keyup.popup-close",function(a){27==a.keyCode&&g()});m?b.show():b.fadeIn();return b}function q(a){return function(){var b=".tpl-block-popup."+a,d=c(b),e=d.last(),d=e.data("closeAll")?d:e,e=e.data("disableAnimation")?1:400;d.fadeOut(e,function(){c(this).remove()});setTimeout(function(){if(!c(b).length){c(f).off("resize",h);var a=c("body");a.attr("style",a.data("ncRequestsStyle")).data("ncRequestsStyle","").off("keyup.popup-close")}},
e+200)}}function h(){c(".tpl-block-popup").each(function(){var a=c(this),b=a.find(".tpl-block-popup-container").css("margin-top",""),d=parseInt(b.css("margin-top"),10),a=Math.round((a.innerHeight()-b.outerHeight())/2);a>d&&b.css("margin-top",a+"px")})}function r(a){return function(b,c,e){"abort"!=c&&n(a,"-message tpl-state-error","<h4>"+c+"</h4><p>"+e+"</p>",!1)}}var l=-1;f.nc_requests_form_init=function(a,b,d){b=c(b||"body").parent().find("."+a.replace(/\s+/,".")+" form");b.off("submit.ajax-submit").on("submit.ajax-submit",
function(b){b.preventDefault();if(d)return!1;b=c(this);c.ajax({type:b.attr("method"),url:b.attr("action"),data:b.serialize()+"&isNaked=1",success:function(b){var c=0>b.indexOf("error");n(a,c?"-message tpl-state-success":"-message tpl-state-error",b,c,!1)},error:r(a)})});d&&b.find("input,select,textarea,button").prop("tabindex",-1)};f.nc_requests_form_popup_init=function(a,b,d,e,m){var g=c(b);if(!g.length)throw"Button not found: "+b;var f=g.closest("form");f.length||(f=c("<form/>"),g.wrap(f));for(var k in e)t(f,
k,e[k]);m&&g.wrap(c("<div/>").css({position:"relative",display:"inline-block"})).after(m);var h=!!m,l;g.off("click.ajax-load").on("click.ajax-load",function(b){b.preventDefault();l&&l.abort();var e={type:"POST",url:f.attr("action")||d,data:f.serialize()+"&isNaked=1",success:function(b){c(document).trigger("nc_requests_form_popup_loaded");var d=n(a,"-form",b,!0,h).data({requestParameters:e,formBlockClasses:a});nc_requests_form_init(a,d,h);h||setTimeout(function(){d.find("input,select,textarea").filter(":visible").first().focus()},
450)},error:r(a)};l=c.ajax(e)})};f.nc_requests_form_popup_reload=function(){c(".tpl-block-popup").each(function(){var a=c(this),b=a.data("formBlockClasses"),a=a.data("requestParameters");b&&a&&(c.ajax(a),c(document).one("nc_requests_form_popup_loaded",q(b)))})}})(jQuery,window);
